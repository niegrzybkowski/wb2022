---
title: "Eksploracyjna analiza danych dotyczących nieruchomości"
author: "Kacper Grzykowski, Dominik Kędzierski, Jakub Piwko"
date: "Marzec 2022"
output:
  html_document:
    toc: true
    toc_float: true
    theme: readable
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(dplyr)
library(tidyverse)
library(DataExplorer)
library(visdat)
```

## Wczytanie danych
```{r}
source("data_loading.R")
real_estate1 <- load_data_EDA()
```


```{r}
str(real_estate1)
```
W ramce znajdują się 82 kolumny i 2919 rekordów. Kolumny reprezentują dane zarówno numeryczne jak i tesktowe. 

## Unikalność i braki danych

```{r}
dim(unique(real_estate1))[1]/dim(real_estate1)[1]
```
Wszystkie dane są unikalne

```{r}
vis_miss(real_estate1[1:41])
```
```{r}
vis_miss(real_estate1[42:82])
```
Jak widać w naszych danych występują kolumny z brakami danych. Jednak większość z nich występuje w specyficznym kontekście, ponieważ dotyczą głównie kolumn opisujących wyposażenie lub specyficzne pomieszczenia w mieszkaniu. Wartość NA ma oznaczać brak danej 'funkcji' w domu. Dlatego zamienimy wartości w tego typu kolumnach na `Absent` w przypadku kolumn typu string, natomiast na -1 w przypadku kolumn liczbowych.   

```{r}
names_col <- c("FireplaceQu", "GarageType", "GarageYrBlt", "GarageFinish", "GarageQual", "GarageCond", "PoolQC", "Fence", "MiscFeature", "Alley", "BsmtQual", "BsmtCond", "BsmtExposure", "BsmtFinType1", "BsmtFinType2")
real_estate <- real_estate1
for (i in 1:(length(names_col))) {
  n <- names_col[i]
  atr <- real_estate[[n]]
  if (is.character(atr)) {
    atr[is.na(atr)] <- "Absent"
    real_estate[n] <- atr
  }
  if (is.numeric(atr)) {
    atr[is.na(atr)] <- "-1"
    real_estate[n] <- atr
  }
}
```

## Analiza rodzajów kolumn

```{r}
introduce(real_estate)
```
Funkcja introduce rozpoznała w naszej kolumnie aż 37 kolumn ciągłych. Zapewne wynika to ze zliczenia kolumn numerycznych. Dużo kolumn numerycznych można jednak uznać za dyskretne, bo przyjmują wartości z ograniczonego zbioru np. liczba łazienek lub kuchni czy ocena ogólnych warunków. 

```{r}
head(real_estate1[c("MSSubClass", "BsmtCond", "BsmtQual")])
```

Kolumna `MSSubClass`, która liczbami koduje typ nieruchomości może zostać zmieniona na typowo tekstową zmienną dyskretną. Natomiast kolumny opisujące jakość lub warunki niektórych elementów mieszkania, zamiast używać skrótów tekstowych, mogą używać skali liczbowej do oceny. Zmiany wymagają także inne kolumny, których wartości da się zakwalifikować jako reprezentujące relacje lepszy-gorszy. 

```{r}
source("preprocessing.R")
#Zamiana liczbowa -> tekstowa
num_var_transform(real_estate)
```

```{r}
#Zamiana tesktowa -> liczbowa
evaluating <- c("ExterQual", "ExterCond", "BsmtQual", "BsmtCond", "HeatingQC", "KitchenQual", "FireplaceQu", "GarageQual", "GarageCond", "PoolQC")

qual_var_transform(real_estate, evaluating)
other_var_transform(real_estate)
```

Po wstępnym przetworzeniu danych, można stwierdzić, że zmienne w zbiorze można podzielić na 3 grupy: zmienne kategoryczne, typowo ciągłe oraz oceniające, czyli takie, w których kryje się już ocena pewnych elementów. 

```{r}
evaluating <- c(evaluating, "BsmtExposure", "BsmtFinType1", "BsmtFinType2", "Functional", "OverallQual", "OverallCond")
continuous <- c("WoodDeckSF", "SalePrice", "OpenPorchSF", "GarageArea", "EnclosedPorch", "PoolArea", "X2ndFlrSF", "X1stFlrSF", "TotalBsmtSF", "GrLivArea", "YearRemodAdd", "YearBuilt", "MasVnrArea", "LotFrontage", "LotArea", "BsmtUnfSF", "BsmtFinSF1", "BsmtFinSF2")
categorical <- colnames(real_estate)[(!colnames(real_estate) %in% evaluating) & (!colnames(real_estate) %in% continuous)]
```